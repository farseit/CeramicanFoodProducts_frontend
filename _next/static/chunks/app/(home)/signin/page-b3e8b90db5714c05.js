(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1782],{16825:function(e,s,t){Promise.resolve().then(t.bind(t,88758))},88758:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return v}});var r=t(57437),a=t(2265),i=t(7476),l=t(16463),n=t(87138),o=t(11444),d=t(44785),c=t(11929),u=t(14595),m=t(66648),p=t(80537);let h=t(38472).Z.create({baseURL:"https://testingbackend.ceramicandfoodproducts.com",withCredentials:!0});h.interceptors.response.use(e=>e,async e=>{var s;console.log("hello interceptors");let t=e.config;if((null===(s=e.response)||void 0===s?void 0:s.status)===401&&!t._retry){t._retry=!0;try{return await h.post("/auth/refresh",{},{withCredentials:!0}),h(t)}catch(e){window.location.href="/login"}}return Promise.reject(e)});var x=t(30998),b=t(64379),f=t.n(b);let g=p.Ry({email:p.Z_().min(1,"Email is required").email("Invalid email format"),password:p.Z_().min(6,"Password must be at least 6 characters")}),w={inputProps:{"aria-label":"Checkbox demo"}};var v=()=>{let[e,s]=(0,a.useState)(!1),t=(0,l.useRouter)(),p=(0,o.I0)(),{loading:b}=(0,o.v9)(e=>e.user),[v,j]=(0,a.useState)({email:"",password:""}),[y,N]=(0,a.useState)({email:"",password:""}),[S,k]=(0,a.useState)(""),C=e=>{j({...v,[e.target.name]:e.target.value}),N({...y,[e.target.name]:""}),k("")},F=async e=>{var s,r,a,i;e.preventDefault(),k("");let l=g.safeParse(v);if(!l.success){let e=l.error.flatten().fieldErrors;N({email:(null===(s=e.email)||void 0===s?void 0:s[0])||"",password:(null===(r=e.password)||void 0===r?void 0:r[0])||""});return}try{p({type:"SignInStart"});let e=(await h.post("".concat("https://testingbackend.ceramicandfoodproducts.com","/auth/login"),{username:v.email,password:v.password},{headers:{"Content-Type":"application/json"},withCredentials:!0})).data,s=(null===(a=e.sub)||void 0===a?void 0:a.role)||e.role;if(!1===e.success){p({type:"SignInFailure",payload:e.message}),(null===(i=e.message)||void 0===i?void 0:i.toLowerCase().includes("invalid"))?N({email:"",password:"Invalid email or password"}):k(e.message||"An unexpected error occurred.");return}d.Z.set("userRole",s,{expires:1/24,secure:!0,sameSite:"Strict"}),d.Z.set("accessToken",e.accessToken,{expires:1/24,secure:!0,sameSite:"Strict",path:"/"}),p({type:"SignInSuccess",payload:e}),f().fire({icon:"success",title:"Signed in successfully!",timer:1500,showConfirmButton:!1}),"admin"===e.role?t.push("/dashboard"):t.push("/userdashboard")}catch(e){p({type:"SignInFailure",payload:e.message}),e.response&&401===e.response.status?(f().fire({icon:"error",title:"Login Failed",text:"Invalid email or password"}),N({email:"",password:"Invalid email or password"})):(f().fire({icon:"error",title:"Server Error",text:"Please try again later."}),k("There was a server error. Please try again."))}},I=async()=>{let e=await (0,x.signIn)("google",{redirect:!1});(null==e?void 0:e.error)?f().fire({icon:"error",title:"Google Sign In Failed",text:e.error}):(f().fire({icon:"success",title:"Signed in successfully!",timer:1500,showConfirmButton:!1}),t.push("/userdashboard"))};return(0,r.jsxs)("section",{className:"grid lg:grid-cols-2 max-h-screen",children:[(0,r.jsxs)("div",{className:"relative hidden md:block",children:[(0,r.jsx)(m.default,{src:"/img/signin.png",width:600,height:800,alt:"signin image",className:"w-full blur-lg max-h-screen object-cover object-top"}),(0,r.jsx)("div",{className:"absolute md:w-[445px] top-1/2 -translate-y-1/2 left-1/2 -translate-x-1/2",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h3",{className:"text-xl font-bold text-white",children:"Sign Up for better experience"}),(0,r.jsx)(n.default,{href:"/signup",className:"block border-2 active:scale-95 hover:border-[#2FB261] hover:text-[#2FB261] border-white text-white text-xl uppercase px-4 py-2 w-full rounded-[10px] mt-6 transition duration-300",children:"Sign Up"})]})})]}),(0,r.jsx)("div",{className:"flex justify-center items-start mt-5",children:(0,r.jsxs)("div",{className:"bg-white p-8 rounded shadow-md w-full max-w-md",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold mb-6 text-center",children:"Sign In"}),(0,r.jsx)("span",{className:"block text-[#9F9F9F] text-xl text-center mb-6",children:"Please enter your details"}),(0,r.jsx)("button",{onClick:I,className:"w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 rounded-md mb-4 transition",children:"Sign in with Google"}),(0,r.jsx)("div",{className:"border-b mt-6 mb-8 relative border-black",children:(0,r.jsx)(u.Z,{className:"-mt-3 bg-white absolute left-1/2 -translate-x-1/2",children:"OR"})}),(0,r.jsxs)("form",{onSubmit:F,children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("input",{type:"text",id:"email",name:"email",value:v.email,onChange:C,placeholder:"Enter your email",className:"w-full p-3 border rounded-md focus:outline-none ".concat(y.email?"border-red-500":"border-[#E8E8F2]")}),y.email&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:y.email})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{type:e?"text":"password",id:"password",name:"password",placeholder:"Password",value:v.password,onChange:C,className:"w-full text-base p-3 placeholder-shown:text-sm border rounded-md focus:outline-none ".concat(y.password?"border-red-500":"border-[#E8E8F2]")}),(0,r.jsx)("button",{type:"button",onClick:()=>s(!e),className:"absolute opacity-50 right-3 top-1/2 -translate-y-1/2",children:e||""===v.password?(0,r.jsx)(i.rzC,{className:"text-xl"}):(0,r.jsx)(i.rDJ,{className:"text-xl"})})]}),y.password&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:y.password}),S&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:S})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[(0,r.jsx)(c.Z,{...w,defaultChecked:!0,sx:{color:"#2FB261","&.Mui-checked":{color:"#2FB261"}}}),(0,r.jsx)("span",{children:(0,r.jsx)("small",{children:(0,r.jsx)(n.default,{href:"/forget_password",children:"Forgot Password?"})})})]}),(0,r.jsx)("button",{type:"submit",disabled:b,className:"active:scale-95 bg-[#2FB261] hover:bg-[#248b4c] text-white text-xl uppercase px-4 py-2 w-full rounded-[10px] mt-6 transition duration-300",children:b?"Signing in...":"Sign In"})]}),(0,r.jsx)(n.default,{href:"/signup",children:(0,r.jsxs)("h6",{className:"text-center mt-3 font-bold text-xl",children:["Don't have an account?"," ",(0,r.jsx)("span",{className:"text-[#2FB261]",children:"Sign Up"})]})})]})})]})}}},function(e){e.O(0,[9461,9956,4047,8472,9537,8173,1444,7138,4455,7883,2971,7023,1744],function(){return e(e.s=16825)}),_N_E=e.O()}]);